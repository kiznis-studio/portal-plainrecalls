---
import Base from '../../layouts/Base.astro';
import { getAllCategories } from '../../lib/db';

const env = Astro.locals.runtime.env;
const categories = await getAllCategories(env);

const ICONS: Record<string, string> = {
  'food': 'ğŸ', 'drugs': 'ğŸ’Š', 'medical-devices': 'ğŸ©º', 'vehicles': 'ğŸš—',
  'children': 'ğŸ§¸', 'electronics': 'ğŸ”‹', 'household': 'ğŸ ', 'outdoor': 'â›º',
  'cosmetics': 'ğŸ’„', 'supplements': 'ğŸ§ª', 'meat-poultry': 'ğŸ¥©', 'appliances': 'ğŸ”Œ',
};

const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: 'Categories', url: '/category' },
];
---

<Base
  title="Recall Categories â€” Food, Drugs, Vehicles & More | PlainRecalls"
  description="Browse product recalls by category. Food, drugs, medical devices, vehicles, children's products, electronics, and more."
  breadcrumbs={breadcrumbs}
>
  <section class="section">
    <div class="mx-auto max-w-5xl px-4">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Recall Categories</h1>
      <p class="mt-2 text-gray-600 dark:text-gray-400">Browse product recalls organized by product type.</p>
      <div class="mt-8 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3">
        {categories.filter(c => c.recall_count > 0).map(cat => (
          <a href={`/category/${cat.slug}`} class="card flex items-start gap-4 hover:shadow-md transition-shadow">
            <span class="text-3xl">{ICONS[cat.category_id] || 'ğŸ“¦'}</span>
            <div>
              <h2 class="font-bold text-gray-900 dark:text-white">{cat.category_name}</h2>
              <p class="mt-0.5 text-sm text-primary-600 dark:text-primary-400 font-medium">{cat.recall_count.toLocaleString()} recalls</p>
              {cat.description && <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{cat.description}</p>}
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>
</Base>
